RPGUI=function(){var RPGUI=RPGUI||{};RPGUI.version=1.04;RPGUI.author="Ronen Ness";RPGUI.init_on_load=true;window.addEventListener("load",function(){if(RPGUI.init_on_load){RPGUI.init()}});RPGUI.init=function(){if(RPGUI._was_init){throw"RPGUI was already init!"}for(var i=0;i<RPGUI.__init_list.length;++i){RPGUI.__init_list[i]()}RPGUI._was_init=true};RPGUI.__init_list=[];RPGUI.on_load=function(callback){if(RPGUI._was_init){callback()}RPGUI.__init_list.push(callback)};RPGUI.__update_funcs={};RPGUI.__create_funcs={};RPGUI.__get_funcs={};RPGUI.__set_funcs={};RPGUI.create=function(element,rpgui_type){if(RPGUI.__create_funcs[rpgui_type]){element.dataset["rpguitype"]=rpgui_type;RPGUI.__create_funcs[rpgui_type](element)}else{throw"Not a valid rpgui type! options: "+Object.keys(RPGUI.__create_funcs)}};RPGUI.update=function(element){var type=element.dataset["rpguitype"];if(RPGUI.__update_funcs[type]){RPGUI.__update_funcs[type](element)}else{RPGUI.fire_event(element,"change")}};RPGUI.set_value=function(element,value){var type=element.dataset["rpguitype"];if(RPGUI.__set_funcs[type]){RPGUI.__set_funcs[type](element,value)}else{element.value=value}RPGUI.update(element)};RPGUI.get_value=function(element){var type=element.dataset["rpguitype"];if(RPGUI.__get_funcs[type]){return RPGUI.__get_funcs[type](element)}else{return element.value}};var _checkbox_class="rpgui-checkbox";RPGUI.__create_funcs["checkbox"]=function(element){RPGUI.add_class(element,_checkbox_class);create_checkbox(element)};RPGUI.__set_funcs["checkbox"]=function(elem,value){elem.checked=value};RPGUI.__get_funcs["checkbox"]=function(elem){return elem.checked};RPGUI.on_load(function(){var elems=document.getElementsByClassName(_checkbox_class);for(var i=0;i<elems.length;++i){RPGUI.create(elems[i],"checkbox")}});function create_checkbox(elem){var new_checkbox=elem.nextSibling;if(!new_checkbox||new_checkbox.tagName!=="LABEL"){throw"After a '"+_checkbox_class+"' there must be a label!"}RPGUI.copy_event_listeners(elem,new_checkbox);(function(elem,new_checkbox){new_checkbox.addEventListener("click",function(){if(!elem.disabled){RPGUI.set_value(elem,!elem.checked)}})})(elem,new_checkbox)}RPGUI.on_load(function(){var contents=document.getElementsByClassName("rpgui-content");for(var i=0;i<contents.length;++i){var content=contents[i];RPGUI.prevent_drag(content);RPGUI.set_cursor(content,"default")}});var _curr_dragged=null;var _curr_dragged_point=null;var _dragged_z=1e3;var _draggable_class="rpgui-draggable";RPGUI.__create_funcs["draggable"]=function(element){element.draggable=false;element.ondragstart=function(){return false};RPGUI.add_class(element,_draggable_class);element.addEventListener("mousedown",mouseDown)};RPGUI.on_load(function(){var elems=document.getElementsByClassName(_draggable_class);for(var i=0;i<elems.length;++i){RPGUI.create(elems[i],"draggable")}window.addEventListener("mouseup",mouseUp)});function mouseUp(e){_curr_dragged=null;window.removeEventListener("mousemove",divMove)}function mouseDown(e){var target=e.target||e.srcElement;if(!RPGUI.has_class(target,_draggable_class)){return}_curr_dragged=target;var rect=_curr_dragged.getBoundingClientRect();_curr_dragged_point={x:rect.left-e.clientX,y:rect.top-e.clientY};target.style.zIndex=_dragged_z++;window.addEventListener("mousemove",divMove,true)}function divMove(e){if(_curr_dragged){_curr_dragged.style.position="absolute";_curr_dragged.style.left=e.clientX+_curr_dragged_point.x+"px";_curr_dragged.style.top=e.clientY+_curr_dragged_point.y+"px"}}var _progress_class="rpgui-progress";RPGUI.__create_funcs["progress"]=function(element){RPGUI.add_class(element,_progress_class);create_progress(element)};RPGUI.__set_funcs["progress"]=function(elem,value){var track=RPGUI.get_child_with_class(elem,"rpgui-progress-track");var progress=RPGUI.get_child_with_class(track,"rpgui-progress-fill");var edge_left=RPGUI.get_child_with_class(elem,"rpgui-progress-left-edge");var edge_right=RPGUI.get_child_with_class(elem,"rpgui-progress-right-edge");progress.style.left="0px";progress.style.width=value*100+"%"};RPGUI.on_load(function(){var elems=document.getElementsByClassName(_progress_class);for(var i=0;i<elems.length;++i){RPGUI.create(elems[i],"progress")}});function create_progress(elem){progress_container=elem;RPGUI.insert_after(progress_container,elem);var track=RPGUI.create_element("div");RPGUI.add_class(track,"rpgui-progress-track");progress_container.appendChild(track);var left_edge=RPGUI.create_element("div");RPGUI.add_class(left_edge,"rpgui-progress-left-edge");progress_container.appendChild(left_edge);var right_edge=RPGUI.create_element("div");RPGUI.add_class(right_edge,"rpgui-progress-right-edge");progress_container.appendChild(right_edge);var progress=RPGUI.create_element("div");RPGUI.add_class(progress,"rpgui-progress-fill");track.appendChild(progress);if(RPGUI.has_class(elem,"blue")){progress.className+=" blue"}if(RPGUI.has_class(elem,"red")){progress.className+=" red"}if(RPGUI.has_class(elem,"green")){progress.className+=" green"}var starting_val=elem.dataset.value!==undefined?parseFloat(elem.dataset.value):1;RPGUI.set_value(elem,starting_val)}var _radio_class="rpgui-radio";RPGUI.__create_funcs["radio"]=function(element){RPGUI.add_class(element,_radio_class);create_radio(element)};RPGUI.__set_funcs["radio"]=function(elem,value){elem.checked=value};RPGUI.__get_funcs["radio"]=function(elem){return elem.checked};RPGUI.on_load(function(){var elems=document.getElementsByClassName(_radio_class);for(var i=0;i<elems.length;++i){RPGUI.create(elems[i],"radio")}});function create_radio(elem){var new_radio=elem.nextSibling;if(!new_radio||new_radio.tagName!=="LABEL"){throw"After a '"+_radio_class+"' there must be a label!"}RPGUI.copy_event_listeners(elem,new_radio);(function(elem,new_radio){new_radio.addEventListener("click",function(){if(!elem.disabled){RPGUI.set_value(elem,true)}})})(elem,new_radio)}var _dropdown_class="rpgui-dropdown";RPGUI.__create_funcs["dropdown"]=function(element){RPGUI.add_class(element,_dropdown_class);create_dropdown(element)};RPGUI.on_load(function(){var elems=document.getElementsByClassName(_dropdown_class);for(var i=0;i<elems.length;++i){RPGUI.create(elems[i],"dropdown")}});function create_dropdown(elem){var arrow_down_prefix="<label>&#9660;</label> ";var select_header=RPGUI.create_element("p");if(elem.id){select_header.id=elem.id+"-rpgui-dropdown-head"}RPGUI.add_class(select_header,"rpgui-dropdown-imp rpgui-dropdown-imp-header");RPGUI.insert_after(select_header,elem);var list=RPGUI.create_element("ul");if(elem.id){list.id=elem.id+"-rpgui-dropdown"}RPGUI.add_class(list,"rpgui-dropdown-imp");RPGUI.insert_after(list,select_header);var header_rect=select_header.getBoundingClientRect();list.style.position="absolute";list.style.width=header_rect.right-header_rect.left-14+"px";list.style.display="none";elem.style.display="none";for(var i=0;i<elem.children.length;++i){var option=elem.children[i];if(option.tagName!="OPTION")continue;var item=RPGUI.create_element("li");item.innerHTML=option.innerHTML;list.appendChild(item);RPGUI.copy_event_listeners(option,item);(function(elem,option,item,select_header,list){item.addEventListener("click",function(){select_header.innerHTML=arrow_down_prefix+option.innerHTML;list.style.display="none";option.selected=true;RPGUI.fire_event(elem,"change")})})(elem,option,item,select_header,list)}(function(elem,list,select_header){select_header.onclick=function(){if(!elem.disabled){var prev=list.style.display;list.style.display=prev=="none"?"block":"none"}};list.onmouseleave=function(){list.style.display="none"}})(elem,list,select_header);(function(elem,select_header,list){_on_change=function(){if(elem.selectedIndex!=-1){select_header.innerHTML=arrow_down_prefix+elem.options[elem.selectedIndex].text}else{select_header.innerHTML=arrow_down_prefix}list.style.display="none"};elem.addEventListener("change",_on_change);_on_change()})(elem,select_header,list)}var _list_class="rpgui-list";RPGUI.__create_funcs["list"]=function(element){RPGUI.add_class(element,_list_class);create_list(element)};RPGUI.on_load(function(){var elems=document.getElementsByClassName(_list_class);for(var i=0;i<elems.length;++i){RPGUI.create(elems[i],"list")}});function create_list(elem){if(!elem.size)elem.size=3;var list=RPGUI.create_element("ul");if(elem.id){list.id=elem.id+"-rpgui-list"}RPGUI.add_class(list,"rpgui-list-imp");elem.parentNode.insertBefore(list,elem.nextSibling);elem.style.display="none";var all_items=[];for(var i=0;i<elem.children.length;++i){var option=elem.children[i];if(option.tagName!="OPTION")continue;var item=RPGUI.create_element("li");item.innerHTML=option.innerHTML;list.appendChild(item);item.dataset["rpguivalue"]=option.value;all_items.push(item);RPGUI.copy_event_listeners(option,item);(function(elem,option,item,list,all_items){item.addEventListener("click",function(){if(!elem.disabled){option.selected=true;RPGUI.fire_event(elem,"change")}})})(elem,option,item,list,all_items)}if(all_items.length&&elem.size){var height=all_items[0].offsetHeight;list.style.height=height*elem.size+"px"}(function(elem,all_items){elem.addEventListener("change",function(){_on_change(this)});function _on_change(elem){for(var i=0;i<all_items.length;++i){var item=all_items[i];if(item.dataset["rpguivalue"]==elem.value){RPGUI.add_class(item,"rpgui-selected")}else{RPGUI.remove_class(item,"rpgui-selected")}}}_on_change(elem)})(elem,all_items)}var _slider_class="rpgui-slider";RPGUI.__create_funcs["slider"]=function(element){RPGUI.add_class(element,_slider_class);create_slider(element)};RPGUI.on_load(function(){var elems=document.getElementsByClassName(_slider_class);for(var i=0;i<elems.length;++i){RPGUI.create(elems[i],"slider")}});function create_slider(elem){var golden=RPGUI.has_class(elem,"golden")?" golden":"";var slider_container=RPGUI.create_element("div");if(elem.id){slider_container.id=elem.id+"-rpgui-slider"}RPGUI.copy_css(elem,slider_container);RPGUI.add_class(slider_container,"rpgui-slider-container"+golden);RPGUI.insert_after(slider_container,elem);slider_container.style.width=elem.offsetWidth+"px";var track=RPGUI.create_element("div");RPGUI.add_class(track,"rpgui-slider-track"+golden);slider_container.appendChild(track);var left_edge=RPGUI.create_element("div");RPGUI.add_class(left_edge,"rpgui-slider-left-edge"+golden);slider_container.appendChild(left_edge);var right_edge=RPGUI.create_element("div");RPGUI.add_class(right_edge,"rpgui-slider-right-edge"+golden);slider_container.appendChild(right_edge);var thumb=RPGUI.create_element("div");RPGUI.add_class(thumb,"rpgui-slider-thumb"+golden);slider_container.appendChild(thumb);elem.style.display="none";RPGUI.copy_event_listeners(elem,slider_container);var state={mouse_down:false};(function(elem,slider_container,thumb,track,state,right_edge,left_edge){var min=parseFloat(elem.min);var max=parseFloat(elem.max);var edges_width=right_edge.offsetWidth+left_edge.offsetWidth;var track_width=track.offsetWidth-edges_width;slider_container.addEventListener("mouseup",function(e){state.mouse_down=false});window.addEventListener("mouseup",function(e){state.mouse_down=false});track.addEventListener("mousedown",function(e){state.mouse_down=true;slide(e.offsetX||e.layerX)});slider_container.addEventListener("mousedown",function(e){state.mouse_down=true});left_edge.addEventListener("mousedown",function(e){set_value(min)});right_edge.addEventListener("mousedown",function(e){set_value(max)});left_edge.addEventListener("mousemove",function(e){if(state.mouse_down)set_value(min)});right_edge.addEventListener("mousemove",function(e){if(state.mouse_down)set_value(max)});function slide(pos){var new_val=min+Math.round(pos/track_width*(max-min))-1;set_value(new_val)}function set_value(new_val){if(!elem.disabled&&elem.value!=new_val){RPGUI.set_value(elem,new_val)}}track.addEventListener("mousemove",function(e){if(state.mouse_down&&!elem.disabled){slide(e.offsetX||e.layerX)}});elem.addEventListener("change",function(e){_onchange()});function _onchange(){var step=track_width/(max-min);var relative_val=Math.round(parseFloat(elem.value)-min);thumb.style.left=Math.floor(edges_width*.25)+relative_val*step+"px"}_onchange()})(elem,slider_container,thumb,track,state,right_edge,left_edge)}RPGUI.create_element=function(element){element=document.createElement(element);return element};RPGUI.set_cursor=function(element,cursor){RPGUI.add_class(element,"rpgui-cursor-"+cursor)};RPGUI.prevent_drag=function(element){};RPGUI.copy_css=function(from,to){to.style.cssText=from.style.cssText};RPGUI.has_class=function(element,cls){return(" "+element.className+" ").indexOf(" "+cls+" ")>-1};RPGUI.add_class=function(element,cls){if(!RPGUI.has_class(element,cls)){element.className+=" "+cls}};RPGUI.get_child_with_class=function(elem,cls){for(var i=0;i<elem.childNodes.length;i++){if(RPGUI.has_class(elem.childNodes[i],cls)){return elem.childNodes[i]}}};RPGUI.remove_class=function(element,cls){element.className=(" "+element.className+" ").replace(cls,"");element.className=element.className.substring(1,element.className.length-1)};RPGUI.fire_event=function(element,type){if("createEvent"in document){var evt=document.createEvent("HTMLEvents");evt.initEvent(type,false,true);element.dispatchEvent(evt)}else{element.fireEvent("on"+type)}};RPGUI.copy_event_listeners=function(from,to){if(typeof getEventListeners=="function"){var events=getEventListeners(from);for(var p in events){events[p].forEach(function(ev){to.addEventListener(p,ev.listener,ev.useCapture)})}}for(attr in from){if(attr.indexOf("on")===0){to[attr]=from[attr]}}};RPGUI.insert_after=function(to_insert,after_element){after_element.parentNode.insertBefore(to_insert,after_element.nextSibling)};return RPGUI}();